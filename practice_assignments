#### SUB-QUERY ASSIGNMENT ####


create table paintings
(
id int,
name varchar(100),
artist_id int,
listed_price int
);

insert into paintings values (11,'Miracle',1,300);
insert into paintings values (12,'Sunshine',1,700);
insert into paintings values (13,'Woman',2,2800);
insert into paintings values (14,'Man',2,2300);
insert into paintings values (15,'Barbie',3,250);
insert into paintings values (16,'Cool Painting',3,5000);
insert into paintings values (17,'Black Square',3,50);
insert into paintings values (18,'Mountains',4,1300);


create table artists
(
id int,
first_name varchar(100),
last_name varchar(100),

);

insert into artists values(1,'Thomas','Black');
insert into artists values(2,'Kate','Smith');
insert into artists values(3,'Natali','Wein');
insert into artists values(4,'Francesco','Benelli');


create table collectors
(
id int,
first_name varchar(100),
last_name varchar(100),

);

insert into collectors values(101,'Brandon','Cooper');
insert into collectors values(102,'Laura','Fisher');
insert into collectors values(103,'Christina','Buffet');
insert into collectors values(104,'Steve','Stevenson');

create table sales_1 
(
id int,
dt date,
painting_id int,
artist_id int,
collector_id int,
sale_price int
);


insert into sales_1 values(1001,'2021-11-01',13,2,104,2500);
insert into sales_1 values(1002,'2021-11-10',14,2,102,2300);
insert into sales_1 values(1003,'2021-11-10',11,1,102,300);
insert into sales_1 values(1004,'2021-11-15',16,3,103,4000);
insert into sales_1 values(1005,'2021-11-22',15,3,103,200);
insert into sales_1 values(1006,'2021-11-22',17,3,103,50);

------  list paintings that are priced higher than the average
select name, listed_price from paintings
where listed_price > (select avg(listed_price) from paintings);

----- list all collectors who purchased paintings from our gallery.

select first_name, last_name from collectors
where id in (select collector_id from sales_1);

select collectors.first_name, collectors.last_name, collector_sales.sales from collectors
join
(select collector_id, sum(sale_price) as sales from sales_1	group by collector_id) as collector_sales
on collectors.id = collector_sales.collector_id;

-----total amount of sales for each artist who has sold at least one painting in our gallery.

SELECT
  artists.first_name,
  artists.last_name,
  artist_sales.sales
FROM artists
JOIN (
    SELECT artist_id, SUM(sale_price) AS sales
    FROM sales_1
    GROUP BY artist_id
  ) AS artist_sales
  ON artists.id = artist_sales.artist_id;
  ----

select first_name, last_name from artists
where id in (select artist_id from sales_1);
----

select artists.first_name, artists.last_name, artist_sales.sales from artists
join
(select artist_id, sum(sale_price) as sales from sales_1
group by artist_id) as artist_sales
on artists.id = artist_sales.artist_id;

------   the first names and the last names of the artists who had zero sales with our gallery
select first_name, last_name,id from artists
where not exists( select * from sales_1 where artists.id = sales_1.artist_id);

